# DB Overview

## 개요

### 튜닝

인덱스, 프로시저, 테이블, 키값 등을 이용하여 퍼포먼스를 높이는 작업.



### SQL Server Profiler 

packet tracer처럼 블랙박스인 프로그램의 쿼리를 추적(tracking)하는 프로그램.

애드온의 경우는 구조를 알아서 필요 없으나, 구조를 모르는 외부 프로그램에서 유용하다.

오류가 났을 때 microsoft사를 통해 만들어 놓은 것은 디버깅을 통해 처리 가능하지만(95% 정도), 모르는 것들은 어떤 쿼리에 의해 오류가 났는지 알 수 있다. (5%정도)



### Microsoft SQL Server Management Studio (SSMS)

백업, 스케쥴링, 조인 등의 작업을 Management Studio에서 수행한다.



### 프로시저

 [Microsoft SQL Server Management Studio - database - programmability - stored procedure] 을 통해 볼 수 있다. 
함수처럼 입력값을 받으면 결과 값을 출력하게 프로그래밍 한 것. 
프로그램 안에서 단순 셀렉문을 통해 뿌릴 수도 있지만, 프로시저를 통해 만들어서 뿌릴 수 도 있다. 이를 매니지먼트 프로그래밍 할 수 있다. 



### HANA 개발 툴

- TOAD (오라클 DBMS 관리 툴)
- HANA Studio (이클립스 기반)
- 리눅스에서의 사용
  - 쉘 스크립트 작성 정도의 능력 요구
  - HANA 스케쥴링 관리는 리눅스 환경에서 크론탭(crontab)을 이용함.
- 윈도우에서 사용
  - RSP(Remote Support Platform) 사용함
  - RSP로 인스턴스 백업, 스케쥴링을 수행함.
  
  

### HANA 정체성

Column Store 기술



### Delta Merge

인메모리 방식의 HANA DB 관리 방법

방법) DB서비스가 시작되고 나면 disk에 기록하는데 최초 서버 일어나고 나면 기록하고, 그 후 모든 것을 로그(디스크에) 기록한다. 따라서 디스크에는 서비스가 처음 시작되었을 때의 데이터밖에 없는데, 서비스를 껐다가 켰을 때 서비스 시작 시 로그를 리플레이 하고 디스크에 올린다. (서비스 시작하자마자 모든 데이터가 올라와 있는 것)

서비스 시작 후 쿼리를 디스크에 저장한다.

DB 사용량이 많지 않을 때마다 한 번 씩 해 준다.

백업 시에 이 파일을 이용함.



## 고객사 DB 관리

### 백업 테스크 생성

1. SQL Server 에이전트 - 시작으로 상태 변경
2. [관리 - 유지 관리 계획-새 유지 관리 계획]
3. 하위 계획 추가



### 백업

1. 왼쪽 메뉴 바의 도구 상자에서 백업 테스크 고른 후 드래그 앤 드랍 또는 더블 클릭.
2. 로컬, 특정 데이터베이스(데모DB) 선택
3. 옵션탭에서 압축 선택.
4. 유지 관리 테스크 추가 후 노드 연결.



### 크론잡

리눅스에서 스케줄 작업할 때 작업들을 뒤져서 실행해 준다.

백업 작업할 때 사용



### ✔동의어

다른 ip 대역에서 select를 수행하기 위해서

다른 서버의 테이블을 조회할 수 있다.

MSSQL, HANA에서 동의어 사용은 유사.

MSSQL에서 다른 DB와의 동의어 복원이 가능한 반면, HANA DB에서는 종속성을 너무 따져서 복원이 안된다. 

HANA DB에서는 어떤 테이블을 사용하고, 생성하는지 다 보여서 동의어가 어긋났을 때 동의어를 하나 씩 지워야 하고, 복원해야 한다. => 따라서 불편해서 Company DB로 다 넣어버리고 동의어를 안 쓴다.  

🚨 Test 서버와 LIve 서버 구분해서 사용할 것.

Drop Create

따로 추가할 것.



### ✔저장 프로시저 SP (save procedure)

매개변수를 이용한 select 

DB 내부에 저장된 일련의 SQL 명령문들을 하나의 함수처럼 실행하기 위한 쿼리의 집합 (프로그램)



### 함수

프로시저 



### 로그

로그 줄이는 것이 필수

2012버전 이후 로그 최적화 알아볼 것.

인스턴스 백업과 스키마 백업 구분

인스턴스 백업을 하면 로그가 클리어됨.

#### Log Volume Size

HANA , SSMS 모두 에서 사용되는 것 (SAP에서는 로그를 사용자가 삭제하지 않도록 함)

인스턴스 백업이 되면 100% 클리어 

DB 서비스가 가동되고 나서 모든 쿼리를 로그에 기록하는데, 델타 머지가 한번 돌아가서 로그 사이즈가 클리어 된다. 



#### 저장 공간이 가득찰 시 발생하는 일

1. Database가 정지하게 된다.
2. SBO 실행 시 오류가 발생한다.
3. SBO 내에서 더 이상의 Data 추가가 불가능하다.



### DB

- Company db
- wjif : 인터페이스 용 서버 

형상 관리는 Dbmaker로 한다. 



### 공부할 것.

sql

프로시저